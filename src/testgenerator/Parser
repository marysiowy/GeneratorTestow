package testgenerator;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.ParserConfigurationException;
import javax.xml.xpath.XPathExpressionException;

import org.xml.sax.SAXException;

import externa.NodeHandler;
import externa.StructuredNode;
import externa.XMLReader;

public class Parser {

	private ArrayList <Question> questions = new ArrayList<Question>();
	public Parser()
	{
		
	}
	
	public ArrayList <Question> paraseFromXMLToObject() throws FileNotFoundException, ParserConfigurationException, SAXException, IOException
	{
		XMLReader r = new XMLReader();
		System.out.println("Przygotuj siÄ™");
		r.addHandler("questions", new NodeHandler() {
		String unitName,questionType,questionText;
		ArrayList<String> answer=new ArrayList<String>();
		ArrayList<String> answerCorrect=new ArrayList<String>();
		
			@Override
			public void process(StructuredNode node) {
				try {

					List<StructuredNode> units = node.queryNodeList("unit");
					for(int i = 0 ; i < units.size(); i++)
					{
						unitName = units.get(i).queryString("@name");
						List<StructuredNode> question = units.get(i).queryNodeList("question");
						 
						for(int j = 0 ; j < question.size(); j ++)
						{
							questionType = question.get(j).queryString("@type");
							questionText = question.get(j).queryString("text");
							List<StructuredNode> answers = question.get(j).queryNodeList("answers");
							
							for(int ij = 0 ; ij<answers.size() ; ij++)
							{
						    		answer.add(answers.get(ij).queryString("answer"));
						    		answerCorrect.add(answers.get(ij).queryString("answer/@correct"));
							}
							questions.add(new Question(unitName,questionType,questionText,answer,answerCorrect));
					
						}

					}

				} catch (XPathExpressionException e) {
					e.printStackTrace();
				}
				
			}
		});
		
		r.parse(new FileInputStream("test.xml"));
		return questions;
	}
}
